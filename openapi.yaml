openapi: 3.0.3
info:
  title: Card Game API
  version: 1.0.0
  description: API specification for Auth, Player, and Game services.

servers:
  - url: http://localhost:8001
    description: Auth Service
  - url: http://localhost:8002
    description: Player Service
  - url: http://localhost:8003
    description: Game Service

paths:

  ###############################################
  # AUTH SERVICE (PORT 8001)
  ###############################################

  /auth/register:
    post:
      summary: Register new user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                email:
                  type: string
                password:
                  type: string
      responses:
        "201":
          description: User registered

  /auth/login:
    post:
      summary: Login and obtain JWT
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: JWT token returned

  /auth/validate:
    get:
      summary: Validate JWT token
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Token is valid

  /health:
    get:
      summary: Health check
      tags: [Auth]
      responses:
        "200":
          description: Alive

  ###############################################
  # PLAYER SERVICE (PORT 8002)
  ###############################################

  /cards:
    get:
      summary: List all cards (public)
      tags: [Player]
      responses:
        "200":
          description: A list of cards

  /cards/{id}:
    get:
      summary: Get card details (public)
      tags: [Player]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Card details

  /matches:
    post:
      summary: Create match record (for statistics)
      tags: [Player]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - player1_external_id
                - player2_external_id
                - player1_score
                - player2_score
                - rounds
                - seed
              properties:
                player1_external_id:
                  type: string
                player2_external_id:
                  type: string
                winner_external_id:
                  type: string
                  nullable: true
                player1_score:
                  type: integer
                player2_score:
                  type: integer
                rounds:
                  type: array
                  items:
                    type: object
                    properties:
                      round_number:
                        type: integer
                      player1_card_id:
                        type: integer
                      player2_card_id:
                        type: integer
                      winner_external_id:
                        type: string
                        nullable: true
                seed:
                  type: string
      responses:
        "201":
          description: Match record created

  /players/{id}/matches:
    get:
      summary: Player match history (public)
      tags: [Player]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of matches

  /players/{id}/matches/{m_id}:
    get:
      summary: Get match details (public)
      tags: [Player]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: m_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Match details

  /leaderboard:
    get:
      summary: Global leaderboard (public)
      tags: [Player]
      responses:
        "200":
          description: A list of player rankings

  /health:
    get:
      summary: Health check
      tags: [Player]
      responses:
        "200":
          description: Service OK

  ###############################################
  # GAME SERVICE (PORT 8003)
  ###############################################

  /matches/:
    post:
      summary: Start new match (protected)
      tags: [Game]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                player1_id:
                  type: string
                player2_id:
                  type: string
      responses:
        "201":
          description: Match started

  /matches/{id}/move:
    post:
      summary: Submit a card move (protected)
      tags: [Game]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                player_id:
                  type: string
                match_card_id:
                  type: integer
      responses:
        "200":
          description: Move accepted

  /matches/{id}:
    get:
      summary: Get match state (protected)
      tags: [Game]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: player_id
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Match state

  /:
    get:
      summary: Health check
      tags: [Game]
      responses:
        "200":
          description: OK

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
